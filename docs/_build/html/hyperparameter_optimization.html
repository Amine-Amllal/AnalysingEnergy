

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Optimisation des hyperparamètres &mdash; AnalysingGreenEnergy 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=f2a433a1"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Évaluation des Modèles" href="model_evaluation.html" />
    <link rel="prev" title="Modèles LSTM" href="lstm_models.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="index.html" class="icon icon-home">
            AnalysingGreenEnergy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Guide d'utilisation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Démarrage rapide</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_description.html">Description des données</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_description.html#export-et-formats">Export et formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_description.html#prochaines-etapes">Prochaines étapes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Analyse des données</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_analysis.html">Analyse des Données</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessing.html">Prétraitement des Données</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modélisation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="lstm_models.html">Modèles LSTM</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Optimisation des hyperparamètres</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction-a-optuna">Introduction à Optuna</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pourquoi-optuna">Pourquoi Optuna ?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-de-base">Configuration de base</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#definition-de-l-espace-de-recherche">Définition de l’espace de recherche</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fonction-objective">Fonction objective</a></li>
<li class="toctree-l3"><a class="reference internal" href="#espace-de-recherche-detaille">Espace de recherche détaillé</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#construction-du-modele-optimisable">Construction du modèle optimisable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fonction-de-construction-modulaire">Fonction de construction modulaire</a></li>
<li class="toctree-l3"><a class="reference internal" href="#validation-avec-pruning">Validation avec pruning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#lancement-de-l-optimisation">Lancement de l’optimisation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuration-de-l-etude">Configuration de l’étude</a></li>
<li class="toctree-l3"><a class="reference internal" href="#callbacks-et-monitoring">Callbacks et monitoring</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#resultats-de-l-optimisation">Résultats de l’optimisation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#meilleurs-parametres-trouves">Meilleurs paramètres trouvés</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analyse-des-resultats">Analyse des résultats</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#visualisations-des-resultats">Visualisations des résultats</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#graphiques-d-optimisation">Graphiques d’optimisation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analyse-de-convergence">Analyse de convergence</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#optimisation-multi-objectifs">Optimisation multi-objectifs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#fonction-objective-multi-objectifs">Fonction objective multi-objectifs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-multi-objectifs">Configuration multi-objectifs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#strategies-d-optimisation-avancees">Stratégies d’optimisation avancées</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#recherche-par-grille-hybride">Recherche par grille hybride</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optimisation-adaptative">Optimisation adaptative</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bonnes-pratiques-d-optimisation">Bonnes pratiques d’optimisation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#gestion-des-ressources">Gestion des ressources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reproductibilite">Reproductibilité</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sauvegarde-et-reprise">Sauvegarde et reprise</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interpretation-des-resultats">Interprétation des résultats</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#analyse-de-sensibilite">Analyse de sensibilité</a></li>
<li class="toctree-l3"><a class="reference internal" href="#validation-finale">Validation finale</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#prochaines-etapes">Prochaines étapes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model_evaluation.html">Évaluation des Modèles</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interface utilisateur</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="interface.html">Interface utilisateur</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Annexes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Dépannage et Résolution de Problèmes</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Questions Fréquentes (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">AnalysingGreenEnergy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Optimisation des hyperparamètres</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/your-username/AnalysingEnergy/blob/main/docs/hyperparameter_optimization.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="optimisation-des-hyperparametres">
<h1>Optimisation des hyperparamètres<a class="headerlink" href="#optimisation-des-hyperparametres" title="Link to this heading"></a></h1>
<p>Cette section détaille l’utilisation d’Optuna pour optimiser automatiquement les hyperparamètres des modèles LSTM.</p>
<section id="introduction-a-optuna">
<h2>Introduction à Optuna<a class="headerlink" href="#introduction-a-optuna" title="Link to this heading"></a></h2>
<section id="pourquoi-optuna">
<h3>Pourquoi Optuna ?<a class="headerlink" href="#pourquoi-optuna" title="Link to this heading"></a></h3>
<p>Optuna est une bibliothèque d’optimisation bayésienne qui présente plusieurs avantages :</p>
<ul class="simple">
<li><p><strong>Optimisation intelligente</strong> : Utilise des algorithmes sophistiqués (TPE, CMA-ES)</p></li>
<li><p><strong>Parallélisation</strong> : Support natif pour l’optimisation distribuée</p></li>
<li><p><strong>Pruning automatique</strong> : Arrête les essais non prometteurs rapidement</p></li>
<li><p><strong>Interface simple</strong> : API intuitive et flexible</p></li>
<li><p><strong>Visualisations</strong> : Outils intégrés pour analyser les résultats</p></li>
</ul>
</section>
<section id="configuration-de-base">
<h3>Configuration de base<a class="headerlink" href="#configuration-de-base" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">optuna</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">optuna.samplers</span><span class="w"> </span><span class="kn">import</span> <span class="n">TPESampler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">optuna.pruners</span><span class="w"> </span><span class="kn">import</span> <span class="n">MedianPruner</span>

<span class="c1"># Configuration du sampler et pruner</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">TPESampler</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>  <span class="c1"># Reproductibilité</span>
<span class="n">pruner</span> <span class="o">=</span> <span class="n">MedianPruner</span><span class="p">(</span>
    <span class="n">n_startup_trials</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>    <span class="c1"># Essais avant activation du pruning</span>
    <span class="n">n_warmup_steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>     <span class="c1"># Étapes avant évaluation</span>
    <span class="n">interval_steps</span><span class="o">=</span><span class="mi">5</span>       <span class="c1"># Fréquence d&#39;évaluation</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="definition-de-l-espace-de-recherche">
<h2>Définition de l’espace de recherche<a class="headerlink" href="#definition-de-l-espace-de-recherche" title="Link to this heading"></a></h2>
<section id="fonction-objective">
<h3>Fonction objective<a class="headerlink" href="#fonction-objective" title="Link to this heading"></a></h3>
<p>La fonction objective définit ce que nous voulons optimiser :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fonction objective pour Optuna.</span>
<span class="sd">    Retourne la métrique à minimiser (validation loss).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># 1. Suggestion des hyperparamètres</span>
    <span class="n">units_1</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;units_1&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
    <span class="n">units_2</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;units_2&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">dropout_rate</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;dropout_rate&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">activation</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;activation&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span> <span class="s1">&#39;relu&#39;</span><span class="p">])</span>
    <span class="n">learning_rate</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># 2. Construction du modèle avec les hyperparamètres suggérés</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span>
        <span class="n">units_1</span><span class="o">=</span><span class="n">units_1</span><span class="p">,</span>
        <span class="n">units_2</span><span class="o">=</span><span class="n">units_2</span><span class="p">,</span>
        <span class="n">dropout_rate</span><span class="o">=</span><span class="n">dropout_rate</span><span class="p">,</span>
        <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
        <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span>
    <span class="p">)</span>

    <span class="c1"># 3. Entraînement avec early stopping</span>
    <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">train_generator</span><span class="p">,</span>
        <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
        <span class="n">validation_data</span><span class="o">=</span><span class="n">val_generator</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span>
            <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">patience</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># 4. Évaluation sur validation</span>
    <span class="n">val_loss</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">val_loss</span>
</pre></div>
</div>
</section>
<section id="espace-de-recherche-detaille">
<h3>Espace de recherche détaillé<a class="headerlink" href="#espace-de-recherche-detaille" title="Link to this heading"></a></h3>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Hyperparamètres optimisés</span><a class="headerlink" href="#id1" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 30.0%" />
<col style="width: 20.0%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Paramètre</p></th>
<th class="head"><p>Plage de recherche</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Impact</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">units_1</span></code></p></td>
<td><p>50-150</p></td>
<td><p>Integer</p></td>
<td><p>Capacité de la 1ère couche LSTM</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">units_2</span></code></p></td>
<td><p>50-100</p></td>
<td><p>Integer</p></td>
<td><p>Capacité de la 2ème couche LSTM</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dropout_rate</span></code></p></td>
<td><p>0.1-0.5</p></td>
<td><p>Float</p></td>
<td><p>Régularisation</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">activation</span></code></p></td>
<td><p>[‘tanh’, ‘relu’]</p></td>
<td><p>Categorical</p></td>
<td><p>Fonction d’activation</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">learning_rate</span></code></p></td>
<td><p>1e-4 à 1e-2</p></td>
<td><p>Float (log)</p></td>
<td><p>Vitesse d’apprentissage</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">batch_size</span></code></p></td>
<td><p>[16, 32, 64]</p></td>
<td><p>Categorical</p></td>
<td><p>Taille des lots</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">epochs</span></code></p></td>
<td><p>30-100</p></td>
<td><p>Integer</p></td>
<td><p>Nombre d’époques max</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="construction-du-modele-optimisable">
<h2>Construction du modèle optimisable<a class="headerlink" href="#construction-du-modele-optimisable" title="Link to this heading"></a></h2>
<section id="fonction-de-construction-modulaire">
<h3>Fonction de construction modulaire<a class="headerlink" href="#fonction-de-construction-modulaire" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">build_model</span><span class="p">(</span><span class="n">units_1</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">units_2</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">dropout_rate</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
               <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construit un modèle LSTM avec des hyperparamètres configurables.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">([</span>
        <span class="n">LSTM</span><span class="p">(</span><span class="n">units_1</span><span class="p">,</span>
             <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
             <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">n_input</span><span class="p">,</span> <span class="n">n_features</span><span class="p">)),</span>

        <span class="n">LSTM</span><span class="p">(</span><span class="n">units_2</span><span class="p">,</span>
             <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">,</span>
             <span class="n">return_sequences</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>

        <span class="n">Dropout</span><span class="p">(</span><span class="n">dropout_rate</span><span class="p">),</span>

        <span class="n">Dense</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>

        <span class="n">Dropout</span><span class="p">(</span><span class="n">dropout_rate</span><span class="p">),</span>

        <span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Sortie pour régression</span>
    <span class="p">])</span>

    <span class="c1"># Optimiseur avec learning rate configurable</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>

    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</section>
<section id="validation-avec-pruning">
<h3>Validation avec pruning<a class="headerlink" href="#validation-avec-pruning" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">objective_with_pruning</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fonction objective avec pruning pour arrêter les essais non prometteurs.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Paramètres suggérés</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;units_1&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;units_1&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
        <span class="s1">&#39;units_2&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;units_2&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
        <span class="s1">&#39;dropout_rate&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;dropout_rate&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
        <span class="s1">&#39;activation&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_categorical</span><span class="p">(</span><span class="s1">&#39;activation&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span> <span class="s1">&#39;relu&#39;</span><span class="p">])</span>
    <span class="p">}</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># Entraînement avec rapports intermédiaires pour pruning</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">):</span>
        <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
            <span class="n">train_generator</span><span class="p">,</span>
            <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">validation_data</span><span class="o">=</span><span class="n">val_generator</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>

        <span class="c1"># Rapport de la loss de validation à Optuna</span>
        <span class="n">val_loss</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">trial</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">val_loss</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span>

        <span class="c1"># Vérification si l&#39;essai doit être prunée</span>
        <span class="k">if</span> <span class="n">trial</span><span class="o">.</span><span class="n">should_prune</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">optuna</span><span class="o">.</span><span class="n">TrialPruned</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">val_loss</span>
</pre></div>
</div>
</section>
</section>
<section id="lancement-de-l-optimisation">
<h2>Lancement de l’optimisation<a class="headerlink" href="#lancement-de-l-optimisation" title="Link to this heading"></a></h2>
<section id="configuration-de-l-etude">
<h3>Configuration de l’étude<a class="headerlink" href="#configuration-de-l-etude" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">run_optimization</span><span class="p">(</span><span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Lance l&#39;optimisation Optuna avec configuration complète.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Création de l&#39;étude</span>
    <span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span>
        <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;minimize&#39;</span><span class="p">,</span>           <span class="c1"># Minimiser la validation loss</span>
        <span class="n">sampler</span><span class="o">=</span><span class="n">TPESampler</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>   <span class="c1"># Algorithme TPE</span>
        <span class="n">pruner</span><span class="o">=</span><span class="n">MedianPruner</span><span class="p">(</span>           <span class="c1"># Pruning médian</span>
            <span class="n">n_startup_trials</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">n_warmup_steps</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">interval_steps</span><span class="o">=</span><span class="mi">5</span>
        <span class="p">),</span>
        <span class="n">study_name</span><span class="o">=</span><span class="s1">&#39;lstm_optimization&#39;</span><span class="p">,</span>
        <span class="n">storage</span><span class="o">=</span><span class="s1">&#39;sqlite:///optuna_study.db&#39;</span><span class="p">,</span>  <span class="c1"># Persistance</span>
        <span class="n">load_if_exists</span><span class="o">=</span><span class="kc">True</span>            <span class="c1"># Reprendre si existe</span>
    <span class="p">)</span>

    <span class="c1"># Optimisation</span>
    <span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span>
        <span class="n">objective_with_pruning</span><span class="p">,</span>
        <span class="n">n_trials</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>  <span class="c1"># 1 heure maximum</span>
        <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">logging_callback</span><span class="p">]</span>  <span class="c1"># Logging personnalisé</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">study</span>
</pre></div>
</div>
</section>
<section id="callbacks-et-monitoring">
<h3>Callbacks et monitoring<a class="headerlink" href="#callbacks-et-monitoring" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">logging_callback</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Callback pour logger les progrès de l&#39;optimisation.&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trial </span><span class="si">{</span><span class="n">trial</span><span class="o">.</span><span class="n">number</span><span class="si">}</span><span class="s2"> terminé:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Valeur: </span><span class="si">{</span><span class="n">trial</span><span class="o">.</span><span class="n">value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Paramètres: </span><span class="si">{</span><span class="n">trial</span><span class="o">.</span><span class="n">params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  État: </span><span class="si">{</span><span class="n">trial</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">trial</span><span class="o">.</span><span class="n">number</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Meilleur essai jusqu&#39;à présent:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Numéro: </span><span class="si">{</span><span class="n">study</span><span class="o">.</span><span class="n">best_trial</span><span class="o">.</span><span class="n">number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Valeur: </span><span class="si">{</span><span class="n">study</span><span class="o">.</span><span class="n">best_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Paramètres: </span><span class="si">{</span><span class="n">study</span><span class="o">.</span><span class="n">best_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="resultats-de-l-optimisation">
<h2>Résultats de l’optimisation<a class="headerlink" href="#resultats-de-l-optimisation" title="Link to this heading"></a></h2>
<section id="meilleurs-parametres-trouves">
<h3>Meilleurs paramètres trouvés<a class="headerlink" href="#meilleurs-parametres-trouves" title="Link to this heading"></a></h3>
<p>Après optimisation avec 50 essais, les meilleurs hyperparamètres obtenus sont :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">best_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;units_1&#39;</span><span class="p">:</span> <span class="mi">74</span><span class="p">,</span>
    <span class="s1">&#39;units_2&#39;</span><span class="p">:</span> <span class="mi">69</span><span class="p">,</span>
    <span class="s1">&#39;dropout_rate&#39;</span><span class="p">:</span> <span class="mf">0.1938213639314652</span><span class="p">,</span>
    <span class="s1">&#39;activation&#39;</span><span class="p">:</span> <span class="s1">&#39;relu&#39;</span>
<span class="p">}</span>

<span class="c1"># Performance obtenue</span>
<span class="n">best_value</span> <span class="o">=</span> <span class="mf">0.0042</span>  <span class="c1"># MSE sur validation</span>
<span class="c1"># RMSE équivalent: ~291.19 MW</span>
</pre></div>
</div>
</section>
<section id="analyse-des-resultats">
<h3>Analyse des résultats<a class="headerlink" href="#analyse-des-resultats" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">analyze_optimization_results</span><span class="p">(</span><span class="n">study</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyse complète des résultats d&#39;optimisation.&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Résumé de l&#39;optimisation ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nombre d&#39;essais: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">study</span><span class="o">.</span><span class="n">trials</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nombre d&#39;essais complétés: </span><span class="si">{</span><span class="nb">len</span><span class="p">([</span><span class="n">t</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">study</span><span class="o">.</span><span class="n">trials</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">optuna</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Nombre d&#39;essais prunés: </span><span class="si">{</span><span class="nb">len</span><span class="p">([</span><span class="n">t</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">study</span><span class="o">.</span><span class="n">trials</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">t</span><span class="o">.</span><span class="n">state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">optuna</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">TrialState</span><span class="o">.</span><span class="n">PRUNED</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Meilleur essai ===&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Valeur: </span><span class="si">{</span><span class="n">study</span><span class="o">.</span><span class="n">best_value</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Paramètres:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">study</span><span class="o">.</span><span class="n">best_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Importance des hyperparamètres</span>
    <span class="n">importance</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">importance</span><span class="o">.</span><span class="n">get_param_importances</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Importance des hyperparamètres ===&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">imp</span> <span class="ow">in</span> <span class="n">importance</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">imp</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="visualisations-des-resultats">
<h2>Visualisations des résultats<a class="headerlink" href="#visualisations-des-resultats" title="Link to this heading"></a></h2>
<section id="graphiques-d-optimisation">
<h3>Graphiques d’optimisation<a class="headerlink" href="#graphiques-d-optimisation" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">optuna.visualization</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">vis</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.io</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pio</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_optimization_plots</span><span class="p">(</span><span class="n">study</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Crée des visualisations de l&#39;optimisation.&quot;&quot;&quot;</span>

    <span class="c1"># 1. Historique d&#39;optimisation</span>
    <span class="n">fig1</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">plot_optimization_history</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># 2. Importance des hyperparamètres</span>
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">plot_param_importances</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
    <span class="n">fig2</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># 3. Coordonnées parallèles</span>
    <span class="n">fig3</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">plot_parallel_coordinate</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
    <span class="n">fig3</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># 4. Slice plot</span>
    <span class="n">fig4</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">plot_slice</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>
    <span class="n">fig4</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># 5. Contour plot (pour paramètres numériques)</span>
    <span class="n">fig5</span> <span class="o">=</span> <span class="n">vis</span><span class="o">.</span><span class="n">plot_contour</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;units_1&#39;</span><span class="p">,</span> <span class="s1">&#39;units_2&#39;</span><span class="p">])</span>
    <span class="n">fig5</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="analyse-de-convergence">
<h3>Analyse de convergence<a class="headerlink" href="#analyse-de-convergence" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_convergence_analysis</span><span class="p">(</span><span class="n">study</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyse la convergence de l&#39;optimisation.&quot;&quot;&quot;</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

    <span class="c1"># Extraire les valeurs des essais</span>
    <span class="n">trials</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">trials</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trials</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">optuna</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">TrialState</span><span class="o">.</span><span class="n">COMPLETE</span><span class="p">]</span>

    <span class="c1"># Meilleure valeur cumulée</span>
    <span class="n">best_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_best</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">current_best</span><span class="p">:</span>
            <span class="n">current_best</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">best_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_best</span><span class="p">)</span>

    <span class="c1"># Graphique de convergence</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">values</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Valeurs des essais&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_values</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">best_values</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Meilleure valeur&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Numéro d</span><span class="se">\&#39;</span><span class="s1">essai&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Validation Loss&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Convergence de l</span><span class="se">\&#39;</span><span class="s1">optimisation&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Distribution des valeurs</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">study</span><span class="o">.</span><span class="n">best_value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Meilleure valeur: </span><span class="si">{</span><span class="n">study</span><span class="o">.</span><span class="n">best_value</span><span class="si">:</span><span class="s1">.6f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Validation Loss&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Fréquence&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribution des performances&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="optimisation-multi-objectifs">
<h2>Optimisation multi-objectifs<a class="headerlink" href="#optimisation-multi-objectifs" title="Link to this heading"></a></h2>
<section id="fonction-objective-multi-objectifs">
<h3>Fonction objective multi-objectifs<a class="headerlink" href="#fonction-objective-multi-objectifs" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">multi_objective_function</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Optimisation multi-objectifs : minimiser la loss ET le temps d&#39;entraînement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

    <span class="c1"># Paramètres suggérés</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;units_1&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;units_1&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span>
        <span class="s1">&#39;units_2&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;units_2&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
        <span class="s1">&#39;dropout_rate&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_float</span><span class="p">(</span><span class="s1">&#39;dropout_rate&#39;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># Mesure du temps d&#39;entraînement</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">train_generator</span><span class="p">,</span>
        <span class="n">epochs</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">validation_data</span><span class="o">=</span><span class="n">val_generator</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span>

    <span class="n">training_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
    <span class="n">val_loss</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">history</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">val_loss</span><span class="p">,</span> <span class="n">training_time</span>  <span class="c1"># Deux objectifs à minimiser</span>
</pre></div>
</div>
</section>
<section id="configuration-multi-objectifs">
<h3>Configuration multi-objectifs<a class="headerlink" href="#configuration-multi-objectifs" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Étude multi-objectifs</span>
<span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span>
    <span class="n">directions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;minimize&#39;</span><span class="p">,</span> <span class="s1">&#39;minimize&#39;</span><span class="p">],</span>  <span class="c1"># Minimiser loss et temps</span>
    <span class="n">sampler</span><span class="o">=</span><span class="n">optuna</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">NSGAIISampler</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">multi_objective_function</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># Analyse du front de Pareto</span>
<span class="n">pareto_solutions</span> <span class="o">=</span> <span class="n">study</span><span class="o">.</span><span class="n">best_trials</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pareto_solutions</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Solution Pareto </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Loss: </span><span class="si">{</span><span class="n">trial</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Temps: </span><span class="si">{</span><span class="n">trial</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Paramètres: </span><span class="si">{</span><span class="n">trial</span><span class="o">.</span><span class="n">params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="strategies-d-optimisation-avancees">
<h2>Stratégies d’optimisation avancées<a class="headerlink" href="#strategies-d-optimisation-avancees" title="Link to this heading"></a></h2>
<section id="recherche-par-grille-hybride">
<h3>Recherche par grille hybride<a class="headerlink" href="#recherche-par-grille-hybride" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">hybrid_optimization</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Combine recherche par grille et optimisation bayésienne.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># 1. Recherche grossière par grille</span>
    <span class="n">grid_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;units_1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span>
        <span class="s1">&#39;activation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;tanh&#39;</span><span class="p">,</span> <span class="s1">&#39;relu&#39;</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="n">best_grid_score</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
    <span class="n">best_grid_params</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">units</span> <span class="ow">in</span> <span class="n">grid_params</span><span class="p">[</span><span class="s1">&#39;units_1&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">activation</span> <span class="ow">in</span> <span class="n">grid_params</span><span class="p">[</span><span class="s1">&#39;activation&#39;</span><span class="p">]:</span>
            <span class="c1"># Test rapide avec paramètres fixes</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="n">units_1</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">activation</span><span class="p">)</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">quick_evaluation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>  <span class="c1"># Évaluation rapide</span>

            <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="n">best_grid_score</span><span class="p">:</span>
                <span class="n">best_grid_score</span> <span class="o">=</span> <span class="n">score</span>
                <span class="n">best_grid_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;units_1&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span> <span class="s1">&#39;activation&#39;</span><span class="p">:</span> <span class="n">activation</span><span class="p">}</span>

    <span class="c1"># 2. Optimisation fine autour des meilleurs paramètres</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">refined_objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
        <span class="c1"># Recherche autour des meilleurs paramètres trouvés</span>
        <span class="n">units_1</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;units_1&#39;</span><span class="p">,</span>
                                   <span class="n">best_grid_params</span><span class="p">[</span><span class="s1">&#39;units_1&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span>
                                   <span class="n">best_grid_params</span><span class="p">[</span><span class="s1">&#39;units_1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span>
        <span class="c1"># ... autres paramètres</span>

        <span class="k">return</span> <span class="n">full_evaluation</span><span class="p">(</span><span class="n">build_model</span><span class="p">(</span><span class="n">units_1</span><span class="o">=</span><span class="n">units_1</span><span class="p">,</span> <span class="o">...</span><span class="p">))</span>

    <span class="c1"># Optimisation Optuna raffinée</span>
    <span class="n">refined_study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;minimize&#39;</span><span class="p">)</span>
    <span class="n">refined_study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">refined_objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">refined_study</span>
</pre></div>
</div>
</section>
<section id="optimisation-adaptative">
<h3>Optimisation adaptative<a class="headerlink" href="#optimisation-adaptative" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">adaptive_optimization</span><span class="p">(</span><span class="n">max_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Optimisation adaptative qui ajuste la stratégie en cours d&#39;exécution.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;minimize&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">trial_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_trials</span><span class="p">):</span>

        <span class="c1"># Adapter la stratégie selon le progrès</span>
        <span class="k">if</span> <span class="n">trial_number</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="c1"># Phase d&#39;exploration</span>
            <span class="n">sampler</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">RandomSampler</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">trial_number</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="c1"># Phase d&#39;exploitation</span>
            <span class="n">sampler</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">TPESampler</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Phase de raffinement</span>
            <span class="n">sampler</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">CmaEsSampler</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

        <span class="c1"># Mise à jour du sampler</span>
        <span class="n">study</span><span class="o">.</span><span class="n">sampler</span> <span class="o">=</span> <span class="n">sampler</span>

        <span class="c1"># Un seul essai avec le sampler adapté</span>
        <span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective_with_pruning</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Analyse du progrès</span>
        <span class="k">if</span> <span class="n">trial_number</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trial </span><span class="si">{</span><span class="n">trial_number</span><span class="si">}</span><span class="s2">: Meilleure valeur = </span><span class="si">{</span><span class="n">study</span><span class="o">.</span><span class="n">best_value</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">study</span>
</pre></div>
</div>
</section>
</section>
<section id="bonnes-pratiques-d-optimisation">
<h2>Bonnes pratiques d’optimisation<a class="headerlink" href="#bonnes-pratiques-d-optimisation" title="Link to this heading"></a></h2>
<section id="gestion-des-ressources">
<h3>Gestion des ressources<a class="headerlink" href="#gestion-des-ressources" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configuration pour éviter l&#39;épuisement des ressources</span>
<span class="k">def</span><span class="w"> </span><span class="nf">resource_aware_objective</span><span class="p">(</span><span class="n">trial</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fonction objective consciente des ressources.&quot;&quot;&quot;</span>

    <span class="c1"># Limiter la complexité du modèle selon les ressources</span>
    <span class="n">max_units</span> <span class="o">=</span> <span class="mi">200</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="mi">100</span>

    <span class="n">units_1</span> <span class="o">=</span> <span class="n">trial</span><span class="o">.</span><span class="n">suggest_int</span><span class="p">(</span><span class="s1">&#39;units_1&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">max_units</span><span class="p">)</span>

    <span class="c1"># Surveillance mémoire</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
    <span class="k">if</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span><span class="o">.</span><span class="n">percent</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">optuna</span><span class="o">.</span><span class="n">TrialPruned</span><span class="p">(</span><span class="s2">&quot;Mémoire insuffisante&quot;</span><span class="p">)</span>

    <span class="c1"># ... reste de la fonction</span>
</pre></div>
</div>
</section>
<section id="reproductibilite">
<h3>Reproductibilité<a class="headerlink" href="#reproductibilite" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assurer la reproductibilité</span>
<span class="k">def</span><span class="w"> </span><span class="nf">set_seeds</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configure tous les seeds pour la reproductibilité.&quot;&quot;&quot;</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">tensorflow</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tf</span>

    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="c1"># Configuration TensorFlow déterministe</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">enable_op_determinism</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="sauvegarde-et-reprise">
<h3>Sauvegarde et reprise<a class="headerlink" href="#sauvegarde-et-reprise" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sauvegarde périodique des résultats</span>
<span class="k">def</span><span class="w"> </span><span class="nf">optimization_with_checkpoints</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Optimisation avec sauvegarde automatique.&quot;&quot;&quot;</span>

    <span class="n">study</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">create_study</span><span class="p">(</span>
        <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;minimize&#39;</span><span class="p">,</span>
        <span class="n">storage</span><span class="o">=</span><span class="s1">&#39;sqlite:///optimization_study.db&#39;</span><span class="p">,</span>
        <span class="n">study_name</span><span class="o">=</span><span class="s1">&#39;lstm_energy_prediction&#39;</span><span class="p">,</span>
        <span class="n">load_if_exists</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Reprendre si interrompu</span>
    <span class="p">)</span>

    <span class="c1"># Callback de sauvegarde</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">checkpoint_callback</span><span class="p">(</span><span class="n">study</span><span class="p">,</span> <span class="n">trial</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">trial</span><span class="o">.</span><span class="n">number</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Sauvegarder les résultats intermédiaires</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;best_params&#39;</span><span class="p">:</span> <span class="n">study</span><span class="o">.</span><span class="n">best_params</span><span class="p">,</span>
                <span class="s1">&#39;best_value&#39;</span><span class="p">:</span> <span class="n">study</span><span class="o">.</span><span class="n">best_value</span><span class="p">,</span>
                <span class="s1">&#39;trial_number&#39;</span><span class="p">:</span> <span class="n">trial</span><span class="o">.</span><span class="n">number</span>
            <span class="p">}</span>

            <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;checkpoint_</span><span class="si">{</span><span class="n">trial</span><span class="o">.</span><span class="n">number</span><span class="si">}</span><span class="s1">.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="n">study</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">checkpoint_callback</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">study</span>
</pre></div>
</div>
</section>
</section>
<section id="interpretation-des-resultats">
<h2>Interprétation des résultats<a class="headerlink" href="#interpretation-des-resultats" title="Link to this heading"></a></h2>
<section id="analyse-de-sensibilite">
<h3>Analyse de sensibilité<a class="headerlink" href="#analyse-de-sensibilite" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">sensitivity_analysis</span><span class="p">(</span><span class="n">study</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyse de sensibilité des hyperparamètres.&quot;&quot;&quot;</span>

    <span class="c1"># Calculer l&#39;importance relative</span>
    <span class="n">importance</span> <span class="o">=</span> <span class="n">optuna</span><span class="o">.</span><span class="n">importance</span><span class="o">.</span><span class="n">get_param_importances</span><span class="p">(</span><span class="n">study</span><span class="p">)</span>

    <span class="c1"># Analyser l&#39;impact de chaque paramètre</span>
    <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">imp</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">importance</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">imp</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">imp</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">importance</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>

    <span class="c1"># Recommandations basées sur l&#39;importance</span>
    <span class="k">if</span> <span class="n">importance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;units_1&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recommandation: Focalisez l&#39;optimisation sur units_1&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">importance</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dropout_rate&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recommandation: dropout_rate peut être fixé&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="validation-finale">
<h3>Validation finale<a class="headerlink" href="#validation-finale" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">final_validation</span><span class="p">(</span><span class="n">best_params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validation finale du modèle avec les meilleurs paramètres.&quot;&quot;&quot;</span>

    <span class="c1"># Construire le modèle final</span>
    <span class="n">final_model</span> <span class="o">=</span> <span class="n">build_model</span><span class="p">(</span><span class="o">**</span><span class="n">best_params</span><span class="p">)</span>

    <span class="c1"># Entraînement complet</span>
    <span class="n">history</span> <span class="o">=</span> <span class="n">final_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">full_train_generator</span><span class="p">,</span>
        <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">validation_data</span><span class="o">=</span><span class="n">test_generator</span><span class="p">,</span>
        <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">patience</span><span class="o">=</span><span class="mi">15</span><span class="p">)]</span>
    <span class="p">)</span>

    <span class="c1"># Évaluation sur test set</span>
    <span class="n">test_loss</span> <span class="o">=</span> <span class="n">final_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_generator</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Performance finale sur test: </span><span class="si">{</span><span class="n">test_loss</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">final_model</span><span class="p">,</span> <span class="n">history</span>
</pre></div>
</div>
</section>
</section>
<section id="prochaines-etapes">
<h2>Prochaines étapes<a class="headerlink" href="#prochaines-etapes" title="Link to this heading"></a></h2>
<p>Avec l’optimisation maîtrisée :</p>
<ol class="arabic simple">
<li><p>Explorez <a class="reference internal" href="model_evaluation.html"><span class="doc">Évaluation des Modèles</span></a> pour évaluer en profondeur</p></li>
<li><p>Consultez <span class="xref std std-doc">notebooks/lstm_training</span> pour des exemples pratiques</p></li>
<li><p>Découvrez <a class="reference internal" href="interface.html"><span class="doc">Interface utilisateur</span></a> pour déployer vos modèles optimisés</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="lstm_models.html" class="btn btn-neutral float-left" title="Modèles LSTM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="model_evaluation.html" class="btn btn-neutral float-right" title="Évaluation des Modèles" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, AMLLAL Amine, HAJJI Mohamed.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>