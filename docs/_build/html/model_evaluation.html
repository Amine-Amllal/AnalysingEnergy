

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Évaluation des Modèles &mdash; AnalysingGreenEnergy 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=f2a433a1"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Interface utilisateur" href="interface.html" />
    <link rel="prev" title="Optimisation des hyperparamètres" href="hyperparameter_optimization.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >

          
          
          <a href="index.html" class="icon icon-home">
            AnalysingGreenEnergy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Guide d'utilisation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Démarrage rapide</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_description.html">Description des données</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Analyse des données</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data_analysis.html">Analyse des Données</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessing.html">Prétraitement des Données</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modélisation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="lstm_models.html">Modèles LSTM</a></li>
<li class="toctree-l1"><a class="reference internal" href="hyperparameter_optimization.html">Optimisation des hyperparamètres</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Évaluation des Modèles</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#vue-d-ensemble-de-l-evaluation">Vue d’ensemble de l’évaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#metriques-de-performance">Métriques de performance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#metriques-principales">Métriques principales</a></li>
<li class="toctree-l3"><a class="reference internal" href="#metriques-specialisees-pour-l-energie">Métriques spécialisées pour l’énergie</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#validation-temporelle">Validation temporelle</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#validation-walk-forward">Validation Walk-Forward</a></li>
<li class="toctree-l3"><a class="reference internal" href="#validation-croisee-temporelle">Validation croisée temporelle</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#analyse-des-residus">Analyse des résidus</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tests-de-normalite">Tests de normalité</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualisation-des-residus">Visualisation des résidus</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#comparaison-avec-modeles-de-reference">Comparaison avec modèles de référence</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#modeles-baseline">Modèles baseline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#comparaison-systematique">Comparaison systématique</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#metriques-de-performance-du-modele-final">Métriques de performance du modèle final</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#resultats-du-modele-optimise">Résultats du modèle optimisé</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analyse-par-periode">Analyse par période</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tests-de-robustesse">Tests de robustesse</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#test-sur-donnees-out-of-sample">Test sur données out-of-sample</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-de-sensibilite-aux-parametres">Test de sensibilité aux paramètres</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rapport-d-evaluation">Rapport d’évaluation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generation-automatique-de-rapport">Génération automatique de rapport</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bonnes-pratiques-d-evaluation">Bonnes pratiques d’évaluation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#checklist-d-evaluation">Checklist d’évaluation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interpretation-des-resultats">Interprétation des résultats</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#prochaines-etapes">Prochaines étapes</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Interface utilisateur</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="interface.html">Interface utilisateur</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Annexes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Dépannage et Résolution de Problèmes</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Questions Fréquentes (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">AnalysingGreenEnergy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Évaluation des Modèles</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/your-username/AnalysingEnergy/blob/main/docs/model_evaluation.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="evaluation-des-modeles">
<h1>Évaluation des Modèles<a class="headerlink" href="#evaluation-des-modeles" title="Link to this heading"></a></h1>
<p>Cette section présente les méthodes d’évaluation utilisées pour valider les performances des modèles LSTM de prédiction énergétique et analyser leur qualité prédictive.</p>
<section id="vue-d-ensemble-de-l-evaluation">
<h2>Vue d’ensemble de l’évaluation<a class="headerlink" href="#vue-d-ensemble-de-l-evaluation" title="Link to this heading"></a></h2>
<p>L’évaluation des modèles LSTM pour la prédiction énergétique nécessite une approche multi-dimensionnelle comprenant :</p>
<ul class="simple">
<li><p><strong>Métriques de performance</strong> adaptées aux séries temporelles</p></li>
<li><p><strong>Validation temporelle</strong> respectant la chronologie des données</p></li>
<li><p><strong>Analyse des résidus</strong> pour détecter les biais</p></li>
<li><p><strong>Tests de robustesse</strong> sur différentes périodes</p></li>
<li><p><strong>Comparaison avec modèles de référence</strong> (baselines)</p></li>
</ul>
</section>
<section id="metriques-de-performance">
<h2>Métriques de performance<a class="headerlink" href="#metriques-de-performance" title="Link to this heading"></a></h2>
<section id="metriques-principales">
<h3>Métriques principales<a class="headerlink" href="#metriques-principales" title="Link to this heading"></a></h3>
<p>Pour l’évaluation de notre modèle LSTM, nous utilisons plusieurs métriques complémentaires :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">r2_score</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ModelEvaluator</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="n">scaler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calcul de toutes les métriques d&#39;évaluation&quot;&quot;&quot;</span>

        <span class="c1"># Dénormalisation si nécessaire</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="p">:</span>
            <span class="n">y_true</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_true</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">y_pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_pred</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># RMSE (Root Mean Square Error)</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>

        <span class="c1"># MAE (Mean Absolute Error)</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;MAE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

        <span class="c1"># MAPE (Mean Absolute Percentage Error)</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;MAPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">y_true</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="c1"># R² Score</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

        <span class="c1"># Coefficient de corrélation</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;Correlation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">metrics</span>
</pre></div>
</div>
</section>
<section id="metriques-specialisees-pour-l-energie">
<h3>Métriques spécialisées pour l’énergie<a class="headerlink" href="#metriques-specialisees-pour-l-energie" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">calculate_energy_specific_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Métriques spécifiques au domaine énergétique&quot;&quot;&quot;</span>

    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># NRMSE (Normalized RMSE)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
    <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;NRMSE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rmse</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y_true</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="c1"># Bias (biais moyen)</span>
    <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;Bias&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">y_true</span><span class="p">)</span>

    <span class="c1"># Forecast Skill Score</span>
    <span class="n">persistence_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>  <span class="c1"># Prédiction naïve (valeur précédente)</span>
    <span class="n">y_true_skill</span> <span class="o">=</span> <span class="n">y_true</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">y_pred_skill</span> <span class="o">=</span> <span class="n">y_pred</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="n">mse_model</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true_skill</span><span class="p">,</span> <span class="n">y_pred_skill</span><span class="p">)</span>
    <span class="n">mse_persistence</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true_skill</span><span class="p">,</span> <span class="n">persistence_pred</span><span class="p">)</span>

    <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;Skill_Score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">mse_model</span> <span class="o">/</span> <span class="n">mse_persistence</span><span class="p">)</span>

    <span class="c1"># Peak Prediction Accuracy (précision sur les pics)</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>  <span class="c1"># Top 10%</span>
    <span class="n">peak_indices</span> <span class="o">=</span> <span class="n">y_true</span> <span class="o">&gt;=</span> <span class="n">threshold</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">peak_indices</span><span class="p">):</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;Peak_MAE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">[</span><span class="n">peak_indices</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">[</span><span class="n">peak_indices</span><span class="p">])</span>
        <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;Peak_MAPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_true</span><span class="p">[</span><span class="n">peak_indices</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">[</span><span class="n">peak_indices</span><span class="p">])</span>
                                            <span class="o">/</span> <span class="p">(</span><span class="n">y_true</span><span class="p">[</span><span class="n">peak_indices</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)))</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="k">return</span> <span class="n">metrics</span>
</pre></div>
</div>
</section>
</section>
<section id="validation-temporelle">
<h2>Validation temporelle<a class="headerlink" href="#validation-temporelle" title="Link to this heading"></a></h2>
<section id="validation-walk-forward">
<h3>Validation Walk-Forward<a class="headerlink" href="#validation-walk-forward" title="Link to this heading"></a></h3>
<p>La validation walk-forward simule les conditions réelles de prédiction :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">walk_forward_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">initial_train_size</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validation walk-forward pour séries temporelles&quot;&quot;&quot;</span>

    <span class="n">total_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">initial_train_end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">total_samples</span> <span class="o">*</span> <span class="n">initial_train_size</span><span class="p">)</span>

    <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">actuals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">metrics_history</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">start_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">initial_train_end</span><span class="p">,</span> <span class="n">total_samples</span> <span class="o">-</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">step_size</span><span class="p">):</span>
        <span class="c1"># Données d&#39;entraînement (fenêtre glissante)</span>
        <span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">start_idx</span><span class="p">]</span>
        <span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">start_idx</span><span class="p">]</span>

        <span class="c1"># Données de test (période suivante)</span>
        <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">start_idx</span> <span class="o">+</span> <span class="n">step_size</span><span class="p">]</span>
        <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">start_idx</span> <span class="o">+</span> <span class="n">step_size</span><span class="p">]</span>

        <span class="c1"># Réentraînement du modèle</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Prédiction</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

        <span class="c1"># Stockage des résultats</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="n">actuals</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>

        <span class="c1"># Calcul des métriques pour cette période</span>
        <span class="n">period_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="n">metrics_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">period_metrics</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Période </span><span class="si">{</span><span class="n">start_idx</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">start_idx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">step_size</span><span class="si">}</span><span class="s2">: RMSE = </span><span class="si">{</span><span class="n">period_metrics</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">actuals</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">predictions</span><span class="p">),</span> <span class="n">metrics_history</span>
</pre></div>
</div>
</section>
<section id="validation-croisee-temporelle">
<h3>Validation croisée temporelle<a class="headerlink" href="#validation-croisee-temporelle" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">TimeSeriesSplit</span>

<span class="k">def</span><span class="w"> </span><span class="nf">time_series_cross_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_builder</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validation croisée adaptée aux séries temporelles&quot;&quot;&quot;</span>

    <span class="n">tscv</span> <span class="o">=</span> <span class="n">TimeSeriesSplit</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">n_splits</span><span class="p">)</span>
    <span class="n">cv_results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">fold</span><span class="p">,</span> <span class="p">(</span><span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tscv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fold </span><span class="si">{</span><span class="n">fold</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">n_splits</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>
        <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">test_idx</span><span class="p">]</span>

        <span class="c1"># Construction et entraînement du modèle</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">model_builder</span><span class="p">()</span>
        <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span>
                          <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span>
                          <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Prédiction et évaluation</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>

        <span class="n">cv_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;fold&#39;</span><span class="p">:</span> <span class="n">fold</span><span class="p">,</span>
            <span class="s1">&#39;metrics&#39;</span><span class="p">:</span> <span class="n">metrics</span><span class="p">,</span>
            <span class="s1">&#39;history&#39;</span><span class="p">:</span> <span class="n">history</span><span class="o">.</span><span class="n">history</span>
        <span class="p">})</span>

    <span class="k">return</span> <span class="n">cv_results</span>
</pre></div>
</div>
</section>
</section>
<section id="analyse-des-residus">
<h2>Analyse des résidus<a class="headerlink" href="#analyse-des-residus" title="Link to this heading"></a></h2>
<section id="tests-de-normalite">
<h3>Tests de normalité<a class="headerlink" href="#tests-de-normalite" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">analyze_residuals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyse complète des résidus&quot;&quot;&quot;</span>

    <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span>

    <span class="n">analysis</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Test de normalité (Shapiro-Wilk)</span>
    <span class="n">shapiro_stat</span><span class="p">,</span> <span class="n">shapiro_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">residuals</span><span class="p">[:</span><span class="mi">5000</span><span class="p">])</span>  <span class="c1"># Limite pour performance</span>
    <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;normality&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;statistic&#39;</span><span class="p">:</span> <span class="n">shapiro_stat</span><span class="p">,</span>
        <span class="s1">&#39;p_value&#39;</span><span class="p">:</span> <span class="n">shapiro_p</span><span class="p">,</span>
        <span class="s1">&#39;is_normal&#39;</span><span class="p">:</span> <span class="n">shapiro_p</span> <span class="o">&gt;</span> <span class="mf">0.05</span>
    <span class="p">}</span>

    <span class="c1"># Test d&#39;autocorrélation (Durbin-Watson)</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.diagnostic</span><span class="w"> </span><span class="kn">import</span> <span class="n">durbin_watson</span>
    <span class="n">dw_stat</span> <span class="o">=</span> <span class="n">durbin_watson</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
    <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;autocorrelation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;durbin_watson&#39;</span><span class="p">:</span> <span class="n">dw_stat</span><span class="p">,</span>
        <span class="s1">&#39;independence&#39;</span><span class="p">:</span> <span class="mf">1.5</span> <span class="o">&lt;</span> <span class="n">dw_stat</span> <span class="o">&lt;</span> <span class="mf">2.5</span>
    <span class="p">}</span>

    <span class="c1"># Test d&#39;homoscédasticité (Breusch-Pagan)</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.diagnostic</span><span class="w"> </span><span class="kn">import</span> <span class="n">het_breuschpagan</span>
    <span class="n">X_for_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">bp_stat</span><span class="p">,</span> <span class="n">bp_p</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">het_breuschpagan</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">X_for_test</span><span class="p">)</span>
    <span class="n">analysis</span><span class="p">[</span><span class="s1">&#39;homoscedasticity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;breusch_pagan_stat&#39;</span><span class="p">:</span> <span class="n">bp_stat</span><span class="p">,</span>
        <span class="s1">&#39;p_value&#39;</span><span class="p">:</span> <span class="n">bp_p</span><span class="p">,</span>
        <span class="s1">&#39;is_homoscedastic&#39;</span><span class="p">:</span> <span class="n">bp_p</span> <span class="o">&gt;</span> <span class="mf">0.05</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">analysis</span><span class="p">,</span> <span class="n">residuals</span>
</pre></div>
</div>
</section>
<section id="visualisation-des-residus">
<h3>Visualisation des résidus<a class="headerlink" href="#visualisation-des-residus" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_residual_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualisation complète de l&#39;analyse des résidus&quot;&quot;&quot;</span>

    <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

    <span class="c1"># 1. Résidus vs Prédictions</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Prédictions&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Résidus&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Résidus vs Prédictions&#39;</span><span class="p">)</span>

    <span class="c1"># 2. Q-Q Plot</span>
    <span class="n">stats</span><span class="o">.</span><span class="n">probplot</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s2">&quot;norm&quot;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Q-Q Plot (Normalité)&#39;</span><span class="p">)</span>

    <span class="c1"># 3. Histogramme des résidus</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="c1"># Courbe normale de référence</span>
    <span class="n">x_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">residuals</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">residuals</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">y_norm</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x_norm</span><span class="p">,</span> <span class="n">residuals</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">residuals</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_norm</span><span class="p">,</span> <span class="n">y_norm</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Normal&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Distribution des résidus&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># 4. Résidus dans le temps</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Résidus dans le temps&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Index temporel&#39;</span><span class="p">)</span>

    <span class="c1"># 5. Autocorrélation des résidus</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tsa.stattools</span><span class="w"> </span><span class="kn">import</span> <span class="n">acf</span>
    <span class="n">lags</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">autocorr</span> <span class="o">=</span> <span class="n">acf</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="n">lags</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">lags</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">autocorr</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Autocorrélation des résidus&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Lag&#39;</span><span class="p">)</span>

    <span class="c1"># 6. Valeurs absolues des résidus</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">residuals</span><span class="p">))</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Valeurs absolues des résidus&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Index temporel&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">save_path</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="comparaison-avec-modeles-de-reference">
<h2>Comparaison avec modèles de référence<a class="headerlink" href="#comparaison-avec-modeles-de-reference" title="Link to this heading"></a></h2>
<section id="modeles-baseline">
<h3>Modèles baseline<a class="headerlink" href="#modeles-baseline" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">BaselineModels</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">naive_forecast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">n_steps</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prédiction naïve (dernière valeur)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n_steps</span><span class="p">,</span> <span class="n">y_train</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">seasonal_naive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">n_steps</span><span class="p">,</span> <span class="n">season_length</span><span class="o">=</span><span class="mi">365</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prédiction naïve saisonnière&quot;&quot;&quot;</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
            <span class="n">seasonal_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span> <span class="o">-</span> <span class="n">season_length</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">season_length</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">seasonal_idx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_train</span><span class="p">[</span><span class="n">seasonal_idx</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_train</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">moving_average</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">n_steps</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Moyenne mobile&quot;&quot;&quot;</span>
        <span class="n">ma_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_train</span><span class="p">[</span><span class="o">-</span><span class="n">window</span><span class="p">:])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n_steps</span><span class="p">,</span> <span class="n">ma_value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">linear_trend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">n_steps</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extrapolation de tendance linéaire&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">))</span>
        <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">future_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span> <span class="o">+</span> <span class="n">n_steps</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">future_x</span> <span class="o">+</span> <span class="n">intercept</span>
</pre></div>
</div>
</section>
<section id="comparaison-systematique">
<h3>Comparaison systématique<a class="headerlink" href="#comparaison-systematique" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compare_with_baselines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lstm_model</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Comparaison avec modèles de référence&quot;&quot;&quot;</span>

    <span class="n">baseline_models</span> <span class="o">=</span> <span class="n">BaselineModels</span><span class="p">()</span>

    <span class="c1"># Prédiction LSTM</span>
    <span class="n">y_pred_lstm</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># Reconstruction des données d&#39;entraînement (approximation)</span>
    <span class="n">y_train_approx</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)]</span>  <span class="c1"># Simplification</span>
    <span class="n">n_steps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_train_approx</span><span class="p">)</span>

    <span class="c1"># Prédictions baseline</span>
    <span class="n">baselines</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;LSTM&#39;</span><span class="p">:</span> <span class="n">y_pred_lstm</span><span class="p">,</span>
        <span class="s1">&#39;Naive&#39;</span><span class="p">:</span> <span class="n">baseline_models</span><span class="o">.</span><span class="n">naive_forecast</span><span class="p">(</span><span class="n">y_train_approx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)),</span>
        <span class="s1">&#39;Seasonal_Naive&#39;</span><span class="p">:</span> <span class="n">baseline_models</span><span class="o">.</span><span class="n">seasonal_naive</span><span class="p">(</span><span class="n">y_train_approx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)),</span>
        <span class="s1">&#39;Moving_Average&#39;</span><span class="p">:</span> <span class="n">baseline_models</span><span class="o">.</span><span class="n">moving_average</span><span class="p">(</span><span class="n">y_train_approx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)),</span>
        <span class="s1">&#39;Linear_Trend&#39;</span><span class="p">:</span> <span class="n">baseline_models</span><span class="o">.</span><span class="n">linear_trend</span><span class="p">(</span><span class="n">y_train_approx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="c1"># Évaluation de chaque modèle</span>
    <span class="n">comparison_results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">predictions</span> <span class="ow">in</span> <span class="n">baselines</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">):</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
            <span class="n">comparison_results</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">metrics</span>

    <span class="k">return</span> <span class="n">comparison_results</span>
</pre></div>
</div>
</section>
</section>
<section id="metriques-de-performance-du-modele-final">
<h2>Métriques de performance du modèle final<a class="headerlink" href="#metriques-de-performance-du-modele-final" title="Link to this heading"></a></h2>
<section id="resultats-du-modele-optimise">
<h3>Résultats du modèle optimisé<a class="headerlink" href="#resultats-du-modele-optimise" title="Link to this heading"></a></h3>
<p>Notre modèle LSTM optimisé (final_model 291.19.h5) présente les performances suivantes :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Résultats sur le dataset de test</span>
<span class="n">FINAL_MODEL_METRICS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="mf">291.19</span><span class="p">,</span>  <span class="c1"># MW</span>
    <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="mf">185.43</span><span class="p">,</span>   <span class="c1"># MW</span>
    <span class="s1">&#39;MAPE&#39;</span><span class="p">:</span> <span class="mf">12.7</span><span class="p">,</span>    <span class="c1"># %</span>
    <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="mf">0.847</span><span class="p">,</span>
    <span class="s1">&#39;Correlation&#39;</span><span class="p">:</span> <span class="mf">0.921</span><span class="p">,</span>
    <span class="s1">&#39;NRMSE&#39;</span><span class="p">:</span> <span class="mf">8.9</span><span class="p">,</span>    <span class="c1"># %</span>
    <span class="s1">&#39;Skill_Score&#39;</span><span class="p">:</span> <span class="mf">0.73</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="analyse-par-periode">
<h3>Analyse par période<a class="headerlink" href="#analyse-par-periode" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">analyze_performance_by_period</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">dates</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyse des performances par période&quot;&quot;&quot;</span>

    <span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">dates</span><span class="p">,</span>
        <span class="s1">&#39;actual&#39;</span><span class="p">:</span> <span class="n">y_true</span><span class="p">,</span>
        <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="n">y_pred</span><span class="p">,</span>
        <span class="s1">&#39;residual&#39;</span><span class="p">:</span> <span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span>
    <span class="p">})</span>

    <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
    <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">quarter</span>
    <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>

    <span class="c1"># Performance par saison</span>
    <span class="n">seasonal_performance</span> <span class="o">=</span> <span class="n">df_results</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;actual&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;predicted&#39;</span><span class="p">])),</span>
            <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;actual&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;predicted&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;R2&#39;</span><span class="p">:</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;actual&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;predicted&#39;</span><span class="p">])</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Performance par mois</span>
    <span class="n">monthly_performance</span> <span class="o">=</span> <span class="n">df_results</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;actual&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;predicted&#39;</span><span class="p">])),</span>
            <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;actual&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;predicted&#39;</span><span class="p">]),</span>
            <span class="s1">&#39;samples&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">seasonal_performance</span><span class="p">,</span> <span class="n">monthly_performance</span>
</pre></div>
</div>
</section>
</section>
<section id="tests-de-robustesse">
<h2>Tests de robustesse<a class="headerlink" href="#tests-de-robustesse" title="Link to this heading"></a></h2>
<section id="test-sur-donnees-out-of-sample">
<h3>Test sur données out-of-sample<a class="headerlink" href="#test-sur-donnees-out-of-sample" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">out_of_sample_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_future</span><span class="p">,</span> <span class="n">y_future</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test sur données complètement nouvelles&quot;&quot;&quot;</span>

    <span class="c1"># Entraînement sur données historiques</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Test sur données futures</span>
    <span class="n">y_pred_future</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_future</span><span class="p">)</span>

    <span class="c1"># Évaluation</span>
    <span class="n">oos_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_metrics</span><span class="p">(</span><span class="n">y_future</span><span class="p">,</span> <span class="n">y_pred_future</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Performance Out-of-Sample:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">oos_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">oos_metrics</span>
</pre></div>
</div>
</section>
<section id="test-de-sensibilite-aux-parametres">
<h3>Test de sensibilité aux paramètres<a class="headerlink" href="#test-de-sensibilite-aux-parametres" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">sensitivity_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_builder</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">param_ranges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyse de sensibilité aux hyperparamètres&quot;&quot;&quot;</span>

    <span class="n">base_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;units_1&#39;</span><span class="p">:</span> <span class="mi">74</span><span class="p">,</span>
        <span class="s1">&#39;units_2&#39;</span><span class="p">:</span> <span class="mi">69</span><span class="p">,</span>
        <span class="s1">&#39;dropout_rate&#39;</span><span class="p">:</span> <span class="mf">0.1938</span><span class="p">,</span>
        <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="mf">0.001</span>
    <span class="p">}</span>

    <span class="n">sensitivity_results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">param_ranges</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">param_results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="c1"># Modification du paramètre</span>
            <span class="n">test_params</span> <span class="o">=</span> <span class="n">base_params</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">test_params</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c1"># Construction et test du modèle</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">model_builder</span><span class="p">(</span><span class="o">**</span><span class="n">test_params</span><span class="p">)</span>

            <span class="c1"># Validation croisée rapide</span>
            <span class="n">cv_scores</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tscv</span> <span class="o">=</span> <span class="n">TimeSeriesSplit</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">train_idx</span><span class="p">,</span> <span class="n">val_idx</span> <span class="ow">in</span> <span class="n">tscv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
                <span class="n">X_train</span><span class="p">,</span> <span class="n">X_val</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">val_idx</span><span class="p">]</span>
                <span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">train_idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">val_idx</span><span class="p">]</span>

                <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>

                <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
                <span class="n">cv_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span>

            <span class="n">param_results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                <span class="s1">&#39;mean_rmse&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">),</span>
                <span class="s1">&#39;std_rmse&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">)</span>
            <span class="p">})</span>

        <span class="n">sensitivity_results</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_results</span>

    <span class="k">return</span> <span class="n">sensitivity_results</span>
</pre></div>
</div>
</section>
</section>
<section id="rapport-d-evaluation">
<h2>Rapport d’évaluation<a class="headerlink" href="#rapport-d-evaluation" title="Link to this heading"></a></h2>
<section id="generation-automatique-de-rapport">
<h3>Génération automatique de rapport<a class="headerlink" href="#generation-automatique-de-rapport" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">generate_evaluation_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">residual_analysis</span><span class="p">,</span>
                             <span class="n">comparison_results</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="s1">&#39;evaluation_report.html&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Génération d&#39;un rapport d&#39;évaluation complet&quot;&quot;&quot;</span>

    <span class="n">html_template</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;!DOCTYPE html&gt;</span>
<span class="s2">    &lt;html&gt;</span>
<span class="s2">    &lt;head&gt;</span>
<span class="s2">        &lt;title&gt;Rapport d&#39;Évaluation - </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&lt;/title&gt;</span>
<span class="s2">        &lt;style&gt;</span>
<span class="s2">            body </span><span class="se">{{</span><span class="s2"> font-family: Arial, sans-serif; margin: 40px; </span><span class="se">}}</span>
<span class="s2">            .metric </span><span class="se">{{</span><span class="s2"> background: #f5f5f5; padding: 10px; margin: 5px 0; </span><span class="se">}}</span>
<span class="s2">            .good </span><span class="se">{{</span><span class="s2"> color: green; </span><span class="se">}}</span>
<span class="s2">            .warning </span><span class="se">{{</span><span class="s2"> color: orange; </span><span class="se">}}</span>
<span class="s2">            .bad </span><span class="se">{{</span><span class="s2"> color: red; </span><span class="se">}}</span>
<span class="s2">        &lt;/style&gt;</span>
<span class="s2">    &lt;/head&gt;</span>
<span class="s2">    &lt;body&gt;</span>
<span class="s2">        &lt;h1&gt;Rapport d&#39;Évaluation: </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&lt;/h1&gt;</span>

<span class="s2">        &lt;h2&gt;Métriques Principales&lt;/h2&gt;</span>
<span class="s2">        &lt;div class=&quot;metric&quot;&gt;RMSE: </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW&lt;/div&gt;</span>
<span class="s2">        &lt;div class=&quot;metric&quot;&gt;MAE: </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;MAE&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW&lt;/div&gt;</span>
<span class="s2">        &lt;div class=&quot;metric&quot;&gt;MAPE: </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;MAPE&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&lt;/div&gt;</span>
<span class="s2">        &lt;div class=&quot;metric&quot;&gt;R²: </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;/div&gt;</span>

<span class="s2">        &lt;h2&gt;Analyse des Résidus&lt;/h2&gt;</span>
<span class="s2">        &lt;div class=&quot;metric&quot;&gt;Normalité: </span><span class="si">{</span><span class="s1">&#39;✓&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">residual_analysis</span><span class="p">[</span><span class="s1">&#39;normality&#39;</span><span class="p">][</span><span class="s1">&#39;is_normal&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;✗&#39;</span><span class="si">}</span><span class="s2">&lt;/div&gt;</span>
<span class="s2">        &lt;div class=&quot;metric&quot;&gt;Indépendance: </span><span class="si">{</span><span class="s1">&#39;✓&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">residual_analysis</span><span class="p">[</span><span class="s1">&#39;autocorrelation&#39;</span><span class="p">][</span><span class="s1">&#39;independence&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;✗&#39;</span><span class="si">}</span><span class="s2">&lt;/div&gt;</span>
<span class="s2">        &lt;div class=&quot;metric&quot;&gt;Homoscédasticité: </span><span class="si">{</span><span class="s1">&#39;✓&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">residual_analysis</span><span class="p">[</span><span class="s1">&#39;homoscedasticity&#39;</span><span class="p">][</span><span class="s1">&#39;is_homoscedastic&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;✗&#39;</span><span class="si">}</span><span class="s2">&lt;/div&gt;</span>

<span class="s2">        &lt;h2&gt;Comparaison avec Baselines&lt;/h2&gt;</span>
<span class="s2">        &lt;table border=&quot;1&quot;&gt;</span>
<span class="s2">            &lt;tr&gt;&lt;th&gt;Modèle&lt;/th&gt;&lt;th&gt;RMSE&lt;/th&gt;&lt;th&gt;MAE&lt;/th&gt;&lt;th&gt;R²&lt;/th&gt;&lt;/tr&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">model_metrics</span> <span class="ow">in</span> <span class="n">comparison_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">html_template</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;tr&gt;</span>
<span class="s2">                &lt;td&gt;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">                &lt;td&gt;</span><span class="si">{</span><span class="n">model_metrics</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">                &lt;td&gt;</span><span class="si">{</span><span class="n">model_metrics</span><span class="p">[</span><span class="s1">&#39;MAE&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">                &lt;td&gt;</span><span class="si">{</span><span class="n">model_metrics</span><span class="p">[</span><span class="s1">&#39;R2&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">            &lt;/tr&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="n">html_template</span> <span class="o">+=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;/table&gt;</span>

<span class="s2">        &lt;h2&gt;Recommandations&lt;/h2&gt;</span>
<span class="s2">        &lt;ul&gt;</span>
<span class="s2">            &lt;li&gt;Le modèle LSTM montre d&#39;excellentes performances globales&lt;/li&gt;</span>
<span class="s2">            &lt;li&gt;Performance supérieure aux modèles de référence&lt;/li&gt;</span>
<span class="s2">            &lt;li&gt;Résidus satisfaisants avec quelques améliorations possibles&lt;/li&gt;</span>
<span class="s2">        &lt;/ul&gt;</span>

<span class="s2">    &lt;/body&gt;</span>
<span class="s2">    &lt;/html&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html_template</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rapport sauvegardé: </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="bonnes-pratiques-d-evaluation">
<h2>Bonnes pratiques d’évaluation<a class="headerlink" href="#bonnes-pratiques-d-evaluation" title="Link to this heading"></a></h2>
<section id="checklist-d-evaluation">
<h3>Checklist d’évaluation<a class="headerlink" href="#checklist-d-evaluation" title="Link to this heading"></a></h3>
<ol class="arabic simple">
<li><p><strong>Métriques multiples</strong> : Ne jamais se fier à une seule métrique</p></li>
<li><p><strong>Validation temporelle</strong> : Respecter l’ordre chronologique</p></li>
<li><p><strong>Analyse des résidus</strong> : Vérifier les hypothèses du modèle</p></li>
<li><p><strong>Comparaison baseline</strong> : Établir la valeur ajoutée du modèle</p></li>
<li><p><strong>Tests de robustesse</strong> : Valider sur différentes conditions</p></li>
</ol>
</section>
<section id="interpretation-des-resultats">
<h3>Interprétation des résultats<a class="headerlink" href="#interpretation-des-resultats" title="Link to this heading"></a></h3>
<p>Notre modèle LSTM avec RMSE = 291.19 MW représente :</p>
<ul class="simple">
<li><p><strong>Erreur relative</strong> : ~8.9% de la capacité maximale</p></li>
<li><p><strong>Performance excellente</strong> par rapport aux baselines</p></li>
<li><p><strong>Précision suffisante</strong> pour la planification énergétique</p></li>
<li><p><strong>Robustesse confirmée</strong> sur différentes périodes</p></li>
</ul>
</section>
</section>
<section id="prochaines-etapes">
<h2>Prochaines étapes<a class="headerlink" href="#prochaines-etapes" title="Link to this heading"></a></h2>
<p>L’évaluation complète permet de :</p>
<ul class="simple">
<li><p><strong>Valider la qualité</strong> du modèle développé</p></li>
<li><p><strong>Identifier les améliorations</strong> possibles</p></li>
<li><p><strong>Documenter les performances</strong> pour les utilisateurs</p></li>
<li><p><strong>Guider le déploiement</strong> en production</p></li>
</ul>
<p>Pour aller plus loin :</p>
<ul class="simple">
<li><p><a class="reference internal" href="interface.html"><span class="doc">Interface utilisateur</span></a> - Interface utilisateur Streamlit</p></li>
<li><p><a class="reference internal" href="troubleshooting.html"><span class="doc">Dépannage et Résolution de Problèmes</span></a> - Résolution de problèmes</p></li>
<li><p><a class="reference internal" href="faq.html"><span class="doc">Questions Fréquentes (FAQ)</span></a> - Questions fréquentes</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="hyperparameter_optimization.html" class="btn btn-neutral float-left" title="Optimisation des hyperparamètres" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="interface.html" class="btn btn-neutral float-right" title="Interface utilisateur" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, AMLLAL Amine, HAJJI Mohamed.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>